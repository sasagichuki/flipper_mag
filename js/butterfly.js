window.Butterfly={diagonal:0,clip_width:0,clip_height:0,ease:.3,frame_per_second:10,mouse:null,follower:null,flippers:[],mirages:[],mirage_i:0,father:null,container:null,marquee:null,fabric:null,is_it_dragging:!1,does_it_laplace:!1,initialize:function(){this.diagonal=Math.sqrt(window.Install.page_width*window.Install.page_width+window.Install.page_height*window.Install.page_height);this.clip_width=window.Install.page_width;this.clip_height=10*window.Install.page_width},install:function(a,b,d){this.mirages=
[];this.flippers=b;this.mirage_i=d;this.mouse={x:2*window.Install.page_width,y:window.Install.page_height};this.follower={x:2*window.Install.page_width,y:window.Install.page_height};this.does_it_laplace=!1;for(b=0;b<this.flippers.length;b++)this.mirages[b]={type:"Idiot",data:null,is_it_ready:!0},null==this.flippers[b]?this.mirages[b]={type:"Atmosphere",data:null,is_it_ready:!0}:this.retrieveMirage(b);1==this.flippers.length%2&&this.mirages.push({type:"Atmosphere",data:null,is_it_ready:!0});this.father=
$(a);this.container=$('<div id="Butterfly"></div>');this.container.css("position","absolute");this.container.css("top",window.Install.page_top+"px");this.container.css("left",Math.floor((window.Install.client_width-window.Install.page_width*window.Install.pages_per_mirage)/2)+"px");this.container.width(2*window.Install.page_width+"px").height(window.Install.page_height+"px");this.container.insertAfter(this.father);this.marquee=$("<canvas></canvas>");this.marquee.attr("width",2*window.Install.page_width+
"px").attr("height",window.Install.page_height+"px");this.marquee.appendTo(this.container);this.fabric=$("<canvas></canvas>");this.fabric.css("position","absolute").css("top",this.marquee.position().top+"px").css("left",this.marquee.position().left+"px");this.fabric.attr("width",2*window.Install.page_width+"px").attr("height",window.Install.page_height+"px");this.fabric.appendTo(this.container);this.layover()},uninstall:function(){this.marquee[0].getContext("2d").clearRect(0,0,2*window.Install.page_width,
window.Install.page_height);this.fabric[0].getContext("2d").clearRect(0,0,2*window.Install.page_width,window.Install.page_height);$("#Butterfly").remove();this.fabric=this.marquee=this.container=this.mirages=null},retrieveMirage:function(a){var b=this,d=new Image;d.onload=function(){b.mirages[a]={type:"Mirage",data:d,is_it_ready:!0}};d.src=this.flippers[a]},layover:function(){this.layover_(0);this.layover__(0)},layover_:function(a){if(null!=this.mirages)if("Idiot"==this.mirages[this.mirage_i].type){var b=
this;setTimeout(function(){b.layover_(a+10)},10);1E3<a&&(this.marquee[0].getContext("2d").fillStyle="#FFFFFF",this.marquee[0].getContext("2d").fillRect(0,0,window.Install.page_width,window.Install.page_height))}else this.paint(this.marquee[0].getContext("2d"),this.mirages[this.mirage_i],0,0)},layover__:function(a){if(null!=this.mirages)if("Idiot"==this.mirages[this.mirage_i+1].type){var b=this;setTimeout(function(){b.layover__(a+10)},10);1E3<a&&(this.marquee[0].getContext("2d").fillStyle="#FFFFFF",
this.marquee[0].getContext("2d").fillRect(window.Install.page_width,0,window.Install.page_width,window.Install.page_height))}else this.paint(this.marquee[0].getContext("2d"),this.mirages[this.mirage_i+1],window.Install.page_width,0)},camera:function(){if(null!=this.mouse){var a=(this.mouse.x-this.follower.x)*this.ease,b=(this.mouse.y-this.follower.y)*this.ease,a=.5>Math.abs(a)?0:a,b=.5>Math.abs(b)?0:b;if(0!=a||0!=b){this.follower.y+=b;this.follower.x+=a;var d=this.follower.x-window.Install.page_width,
c=window.Install.page_height-this.follower.y,e=Math.cos(Math.atan2(c,d))*window.Install.page_width+window.Install.page_width,d=window.Install.page_height-Math.sin(Math.atan2(c,d))*window.Install.page_width,a=this.follower.x,b=this.follower.y;Math.sqrt((window.Install.page_height-d)*(window.Install.page_height-d)+(e-window.Install.page_width)*(e-window.Install.page_width))<Math.sqrt((window.Install.page_height-this.follower.y)*(window.Install.page_height-this.follower.y)+(this.follower.x-window.Install.page_width)*
(this.follower.x-window.Install.page_width))&&(a=e,b=d);d=window.Install.page_width-a;c=b;Math.sqrt(d*d+c*c)>this.diagonal&&(a=-Math.cos(Math.atan2(c,d))*this.diagonal+window.Install.page_width,b=Math.sin(Math.atan2(c,d))*this.diagonal);var c=this.does_it_laplace?a/2:(2*window.Install.page_width-a)/2+a,k=(window.Install.page_height-b)/2+b,g=0,g=c+Math.tan(Math.atan2(window.Install.page_height-k,this.does_it_laplace?c:2*window.Install.page_width-c))*(window.Install.page_height-k)*(this.does_it_laplace?
1:-1);0>g&&(g=0);var e=this.does_it_laplace?Math.atan2(-(window.Install.page_height-b),-(g-a)):Math.atan2(window.Install.page_height-b,g-a),f=0,d=window.Install.page_height/2,h=0,f=Math.atan2(window.Install.page_height-k,c-g),h=(f/Math.abs(f)*90-180*f/Math.PI)/180*Math.PI,l=this.clip_width/2/Math.cos(h),f=l*(this.does_it_laplace?1:-1)-((c-g)*window.Install.page_height/2+(g*k-c*window.Install.page_height))/(window.Install.page_height-k),c=this.fabric[0].getContext("2d");c.clearRect(0,0,this.fabric.width(),
this.fabric.height());c.save();c.translate(f,d);c.rotate(h);c.beginPath();c.rect(-this.clip_width/2,-this.clip_height/2,this.clip_width,this.clip_height);c.clip();c.rotate(-h);c.translate(-f,-d);c.translate(a+window.Install.page_width/2*Math.cos(e)*(this.does_it_laplace?-1:1)+window.Install.page_height/2*Math.sin(e),b-window.Install.page_height/2*Math.cos(e)+window.Install.page_width/2*Math.sin(e)*(this.does_it_laplace?-1:1));c.rotate(e);this.paint(c,this.mirages[this.does_it_laplace?this.mirage_i-
1:this.mirage_i+2],-window.Install.page_width/2,-window.Install.page_height/2);c.restore();c.save();c.translate(f+(this.does_it_laplace?3*-l:l),d);c.rotate(h);c.beginPath();c.rect(0,-this.diagonal,this.clip_width,this.clip_height);c.clip();c.rotate(-h);c.translate(-(f+(this.does_it_laplace?3*-l:l)),-d);c.translate(0,0);this.paint(c,this.mirages[this.does_it_laplace?this.mirage_i-2:this.mirage_i+3],this.does_it_laplace?0:window.Install.page_width,0);c.restore()}}},paint:function(a,b,d,c){"undefined"!=
typeof b&&("Mirage"==b.type?b.is_it_ready&&a.drawImage(b.data,d,c,window.Install.page_width,window.Install.page_height):"Atmosphere"==b.type&&(a.fillStyle=window.Atmosphere.color,a.fillRect(d,c,window.Install.page_width,window.Install.page_height)))},origamiPrepare:function(a,b){0<=b&&b<=window.Install.page_height&&(0<=a&&a<window.Install.page_width?(this.mouse={x:0,y:window.Install.page_height},this.does_it_laplace||(this.does_it_laplace=!0,this.follower={x:0,y:window.Install.page_height})):a>=window.Install.page_width&&
a<=2*window.Install.page_width?(this.mouse={x:2*window.Install.page_width,y:window.Install.page_height},this.does_it_laplace&&(this.does_it_laplace=!1,this.follower={x:2*window.Install.page_width,y:window.Install.page_height})):this.mouse={x:this.does_it_laplace?0:2*window.Install.page_width,y:window.Install.page_height},this.is_it_dragging=!0)},origamiFold:function(a,b){this.is_it_dragging?this.mouse={x:a,y:b}:0<=b&&b<window.Install.page_height?0<=a&&a<window.Install.page_width?(this.mouse={x:0,
y:window.Install.page_height},this.does_it_laplace||(this.does_it_laplace=!0,this.follower={x:0,y:window.Install.page_height})):a>=window.Install.page_width&&a<2*window.Install.page_width?(this.mouse={x:2*window.Install.page_width,y:window.Install.page_height},this.does_it_laplace&&(this.does_it_laplace=!1,this.follower={x:2*window.Install.page_width,y:window.Install.page_height})):this.mouse={x:this.does_it_laplace?0:2*window.Install.page_width,y:window.Install.page_height}:this.mouse={x:this.does_it_laplace?
0:2*window.Install.page_width,y:window.Install.page_height}},origamiDone:function(a,b){this.is_it_dragging=!1;if(this.does_it_laplace?0!=this.mirage_i:this.mirage_i!=this.mirages.length)this.mouse=(this.does_it_laplace?a>window.Install.page_width:a<window.Install.page_width)?{x:this.does_it_laplace?2*window.Install.page_width:0,y:window.Install.page_height}:{x:this.does_it_laplace?0:2*window.Install.page_width,y:window.Install.page_height}}};